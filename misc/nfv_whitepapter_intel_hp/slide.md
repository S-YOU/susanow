
# NFV Whitepaper by Intel&HP

- Hiroki SHIROKURA @slankdev
- 2018.07.30

本レポートは以下のWhitepaperをよんで筆者なりにまとめたものである
```
https://www.altera.co.jp/content/dam/altera-www/global/ja_JP/pdfs/literature/wp/wp-01273-finding-an-efficient-virtual-network-function-architecture_j.pdf
```


## はじめに

- 世界のIPトラフィックは今後の5年間で3倍に
- 世界の通信プロバイダ各社は需要に応えるとともにより低コストにしたい
- ITインフラを仮想化する方法を模索している
- 現行システムの独自規格HWは高額であり、拡張が容易ではない
- 複数APPでコンピュータ資源を共有し,HWコストをへらすことができる
- NFVはSPが真の仮想化インフラに移行するためのテクノロジとして登場した
- AT&T, China TelecomなどによりNFVは勢いづいている
- NFVが目指す未来像は着実に実現しつつある

本白書では以下を行う
- SPが直面している主な問題明示
- 相対コスト問題に効果的に対処するVNFフレームワークの拡張アーキテクチャに
  ついて説明する
- このアーキテクチャは実用的VNFの先駆けとなることを目標としている


## ネットワークとデータセンターの結合

China Telecom調べ
- バックボーンNW帯域消費率が過去3年で42%増加
- 大都市圏のNWトラフィックはバックボーントラフィックの1.5-2倍の割合で増加

加入者の需要も急激に増加
- 4K TV, 8K TV
- 仮想現実, 拡張現実
- オンラインバックアップストレージ
- 等の新しいユースケース

モビリティ
- データや接続のsrc dstはリアルタイムに変化しより複雑に

IoTにより以下が増加
- 接続されるモノの数
- 連続的に生成されるデータの量

サービスプロバイダの最大のコアリソースはNW自体である (China Telecom)
- クラウドや仮想化が誕生した目的は, IT機能の急拡大に効率良く対応するため
- 現状, クラウドとネットワークは柔軟に連携できていない
- 以下の二つは同時に成長していくべきである
	- クラウドテクノロジーが高度に洗練され動的になる
	- SDNを用いたネットワーク構成の自動化
- 現状, ネットワークの仮想化は遅れている
- ネットワークの仕事量は、アプリケーションの仕事量とは全く異なる
- 新しいアプリケーションが高いパケットレートを必要とするのに伴い、
  以下のアプリケーションの回線速度を維持することが非現実的になり、
	結果として設備投資と運用コストが 大幅に増えていきます。
	- QoS/トラフィック・シェーピング
	- 仮想プライベート・ネットワーク (VPN)、
	- ファイアウォール、
	- ネットワーク・アドレス変換
	- カプセル化/カ プセル化解除、
	- ディープ・パケット・インスペクション(DPI)、
	- リアルタイム・ モニタリング
- これは、高度に動的で仮想化されたインフラス トラクチャーの導入にも直接影響
  するため,既存の通信ネットワークの変革に遅れが生じる要因となっている


## 効率的なVNFの実装が不可欠

VNFとは
- 専用HW向けに構築されたSWから標準サーバ上で動作する仮装SWへと機能移行したもの
- 独自規格で値段も高額なHWのニーズを減らす
- 現状, 仮想化環境に向け十分に最適化されていない
- 専用HWと比べパフォーマンスが低い
- NFV/SDN/オーケストレーションを利用すれば運用上の複雑性は軽減する
- パフォーマンス不足を克服するために必要なインフラコストの高さは変わらない
- NFV導入の課題は全体的なCAPEX/OPEXを減らすこと
- NFVモデルはまだ新しく, コスト削減を達成するための最適化要素がたくさんある

VNFの現状
- VNFの必要性は広く認識されている
- VNFの開発方法やアーキテクチャに関する明確なガイドライン不足は認識されていない
- VNFの要件
	- オートメーション
	- オーケストレーション
	- 専用HW機能より優れているもの (フレキシビリティ)

CUPS (Control and User Plane Separation)
- 個別の拡張が可能になる
- 帯域幅要求の急増によりDplaneのリソース効果と拡張性を高める必要がある

最適化されたOff-theShelfベースの際プログラム可能なDplane
- 汎用PCの使用はNFVの核となるテーマの一つ
- コントロールプレーンの拡張は簡単
- データプレーンの拡張は困難
	- 再構成可能なパケットパイプライン
	- 複雑なパケット処理に非常に高いスループットで対応できるようなシステム設計
- Dplaneは暗号化/復号処理などの高演算負荷のタスクもwirerateで実行する必要ある

VNFの隔離を最大限に高める　
- VNFのチェイニングが複雑化すると複数PCが連携する必要もある
- SFCが拡大するとNFVインフラの管理,拡張,運用はさらに難しくなる

VNFの拡大/隔離の必要性
- VMやコンテナでは1つの機能が複数のCPUで動作することができる
- チェイニングが最適でなく, VNFが無秩序に拡大するとインフラの不可増大になる

VNFの拡大と隔離の必要性<br>
以下のような構成で、「VNFが拡大」してしまうと, インフラのファブリックの
合計帯域が増加する。
<p><img src="./img/fig01.png" width="100%"/></p>

## CTNet2025: 2025までのChinaTelecomネットワークの変革

China Telecomは次の技術が新しいNWアーキテクチャに重要だと判断した.

- SDNの実装
- 2025年までにインフラストラクチャーの80%を仮想化
- クラウドコンピューティングテクノロジーの活用
- OSSの使用

これらに不可欠なVNFはvBRAS, vPE, vEPC, vIMS, vOLTである.


## 拡張性と効率性の高いvBRASアーキテクチャへ

China Telecom, HPE, Intelの設計目標
- Architecture
	- CPUSを第一段階
	- クラウドネイティブ設計原則をサポート
- Efficient&performance
	- 電力消費量は4KW/Tbps
	- 各ノードは100Gbps以上
- Relative cost
	- SmartNICを用いた50%おコスト削減
	- 将来の世代に対応できる拡張性を実現する

BRASからvBRASへの進化
- 物理アプライアンス (a)
- vBRAS (b)
- CUPSの実現 (c)

<p><img src="./img/fig02.png" width="100%"/></p>

前述の(c)を実現する,効率的なvBRAS設計(図4)

<p><img src="./img/fig03.png" width="100%"/></p>

vBRAS-c Node
- コンテナ実装に適している
- 必要に応じて新規ユーザを追加
- vBRAS-cインスタンスがロケーションに依存しなくなる
- vBRAS-cを集中管理したり分散管理したりどちらも可能

vBRAS-d Node
- パケット処理専用のノード
- 一部のコアにパケット転送のみを割り当て
- 残りのコアに複雑なパケット処理を行わせる
- Intel Arria10 FPGA based SmartNICが使われる
- FPGAは以下の複雑なパケット処理機能を実行する
	- QoS, VPN, NAT, DPI
- FPGAには利点がある
	- 40%をQoSとシェービングに費やした場合
	- 60%を別のパケット処理に適用できる
	- デプロイ環境に合わせて機能を変えることができる
		- DPIの独自アルゴリズム
		- ストリーミングコンテンツの動的encode/decode
		- アプリケーション固有のユースケースに同じサーバを用いられる

SDNコントローラ
- vBRAS-dのみを制御する
- vBRAS-cがSDNコントローラになることもできる

Intel Arria10 FPGA based SmartNIC
- 複数の並列パケット処理パイプライン(40/100GbE以上)に対応するように構成可能
- レイテンシはASIC/ASSPで発生するレイテンシと同様
- 機能アップデートに対しハードウェアアップデートが必要ない
- 製品のアップグレードサイクルを速めることができる

<p><img src="./img/fig04.png" width="100%"/></p>

ベンダに依存しないオープンエコシステム
- CUPSがこのアーキテクチャの肝
- 複数ベンダが寄与する駅システムで促進される
- 本WhitePapaerではintel HPEだが,他にも様々なベンダで構成可能
- 多数ベンダでAPI定義の協調的議論


## vBRASのパフォーマンス結果
## 効果的なvBRASで早退コストを削減
## 他のCUPS実装との比較

## まとめ

- サービスの集中に伴い、 ネットワーク機器はより複雑になった
- 新規ビジネスの導入サイクルは以下によりかつてないほど延長する
	- 機器が高度に特殊化
	- HW/SWの結び付きが強まり
	- 拡張が難しくなり
	- アップグレードサイクルが長くなり、
- 仮想NWの再設計によって,サービス導入コストは削減され,効率性は向上します。
	- 以下をリソースプールから利用することが可能
		- ビジネスルール
		- ネットワーク機能、
		- インフラストラクチャー
- ここで紹介した 新しいアーキテクチャーは, SDN/NFVを融合したもの
- クラウドとネットワークが結合され, 未来のDCがネットワークの核となる
- 完全に仮想化されたインフラストラクチャーに移行すると以下が可能に
  - 発展する市場の需要に容易に対応できる
  - 設備投資と運用コス トを減らして全体的なコストを抑える



